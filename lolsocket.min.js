(function(e){typeof define==="function"&&define.amd?define(e):e();}(function(){"use strict";var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function t(e){this.message=e}t.prototype=new Error;t.prototype.name="InvalidCharacterError";function n(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=n;return t}var r=n(e);r["-"]="62",r["_"]="63";function o(e){return e.replace(/[=]+$/,"").replace(/-/g,"+").replace(/_/g,"/")}function u(e){return e.length%4==0?e:"=".repeat(4-e.length%4)}function a(e){var t=o(e);return t.length%4==1&&console.error("'atob' failed: The string to be decoded is not correctly encoded."),t.match(/[^a-zA-Z0-9+/]/g)&&console.error("'atob' failed: The string to be decoded is not correctly encoded."),decodeURIComponent(atob(u(t)).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function i(e){if(typeof e!=="string")throw new t("Invalid token specified");e=e.split(".")[1];return e=e.replace(/-/g,"+").replace(/_/g,"/"),a(e)}function c(e){this.apiKey=e.API_KEY,this.apiSecret=e.API_SECRET;var t=e.TLS?4000:3000;this.socket=new WebSocket("wss://ws.lolcorp.co.uk:"+t+"/"+e.API_KEY),this.socket.onerror=function(e){console.log("disconnected")},this.socket.onopen=function(){console.log("connected")},this.channels={},this.socket.onmessage=function(e){var t=JSON.parse(e.data),n=t.type,r=t.channel,o=t.content;if(n==="message"){if(this.channels[r])this.channels[r].forEach(function(e){e(o)}}if(n==="token"){this.token=t.token;var u=i(t.token);this.userID=u.userId,localStorage.setItem("LOL_USER_ID",u.userId)}},this.subscribe=function(e){var t=this,n=this.apiKey+"-"+e,r={type:"subscribe",channel:e,secret:this.apiSecret,token:this.token};this.socket.send(JSON.stringify(r)),this.channels[n]||(this.channels[n]=[]);return{bind:function(r,i){t.channels[n].push({type:r,callback:i}),t.socket.onmessage=function(e){var r=JSON.parse(e.data),s=r.emit_type,o=r.content;t.channels[n].forEach(function(e){e.type===s&&e.callback(o)})}}},this.trigger=function(e,t,n){var r=e.startsWith("client-"),o=this.apiKey+"-"+e;this.subscribe(e),r?this.socket.send(JSON.stringify({type:"client-publish",emit_type:t,channel:e,content:n,secret:this.apiSecret,userId:this.userID,token:this.token})):this.socket.send(JSON.stringify({type:"publish",emit_type:t,channel:e,content:n,secret:this.apiSecret,userId:this.userID,token:this.token}))};}module.exports=c;}));
